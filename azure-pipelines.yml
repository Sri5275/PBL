# azure-pipelines.yml

trigger:
- main

pool:
  vmImage: 'windows-latest'

variables:
- group: Pipeline

steps:
- task: PowerShell@2
  displayName: 'Perform Static Code Analysis'
  inputs:
    targetType: 'inline'
    script: |
      # Define owner, repo, and token
      $owner = "Sri5275"
      $repo = "PBL"
      $token = "$(GitHubPAT)"

      # Set API endpoint with query parameters
      $apiEndpoint = "https://codeanalysis.azurewebsites.net/CodeAnalysis/PerfromStaticCodeAnalysis?owner=$owner&repo=$repo&token=$(GitHubPAT)"

      # Make HTTP request to perform static code analysis
      $response = Invoke-RestMethod -Uri $apiEndpoint -Method Post

      # Check response status
      if ($response.StatusCode -eq 200) {
          Write-Host "Static code analysis performed successfully"
      } else {
          Write-Host "Failed to perform static code analysis. Status code: $($response.StatusCode)"
          exit 1
      }
